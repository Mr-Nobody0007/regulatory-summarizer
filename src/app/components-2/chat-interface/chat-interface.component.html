<div class="chat-interface-container">
    <!-- Loading State -->
    <div *ngIf="isLoading && !documentInfo?.title" class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading document...</p>
    </div>
  
    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="error-container">
      <mat-icon color="warn">error_outline</mat-icon>
      <h3>{{ error }}</h3>
      <button mat-raised-button color="primary" (click)="backToSearch()">
        Return to Search
      </button>
    </div>
  
    <!-- Main Chat Interface with revised layout -->
    <div *ngIf="documentInfo && !error && !isLoading" class="chat-layout">
      <!-- Top Section: Document Header -->
      <div class="document-header-section">
        <div class="back-navigation">
          <button mat-button color="primary" (click)="backToSearch()">
            <mat-icon>chevron_left</mat-icon>
            Search for another document
          </button>
        </div>
        
        <div class="document-title-area">
          <h2 class="doc-title">{{ documentInfo.id }} {{ documentInfo.title }}</h2>
          
          <div class="doc-metadata">
            <div class="meta-item">
              <a href="javascript:void(0)" class="pdf-link" (click)="openPdfDocument()">
                <span class="meta-tag">PDF</span>
              </a>
              <span class="meta-bullet">•</span>
              <span>{{ documentInfo.documentType }}</span>
              <span class="meta-bullet">•</span>
              <span>Published {{ documentInfo.publicationDate }}</span>
              <span class="meta-bullet">•</span>
              <span>Agency: {{ documentInfo.agency }}</span>
            </div>
          </div>
        </div>
        
        <button mat-button class="more-button" (click)="toggleExtendedMetadata()">
          {{ showExtendedMetadata ? 'Less details' : 'More details' }}
          <mat-icon>{{ showExtendedMetadata ? 'expand_less' : 'expand_more' }}</mat-icon>
        </button>
        
        
    <div class="extended-metadata" *ngIf="showExtendedMetadata">
        <div class="extended-meta-grid">
            <!-- Document Number -->
            <div class="extended-meta-item" *ngIf="documentInfo.documentNumber">
                <span class="meta-label">Document No:</span>
                <span>{{ documentInfo.documentNumber }}</span>
            </div>
    
            <!-- Effective Date -->
            <div class="extended-meta-item" *ngIf="documentInfo.effectiveDate">
                <span class="meta-label">Effective Date:</span>
                <span>{{ documentInfo.effectiveDate }}</span>
            </div>
    
            <!-- Citation -->
            <div class="extended-meta-item" *ngIf="documentInfo.citation">
                <span class="meta-label">Citation:</span>
                <span>{{ documentInfo.citation }}</span>
            </div>
    
            <!-- CFR References -->
            <div class="extended-meta-item" *ngIf="documentInfo.cfrReferences && documentInfo.cfrReferences.length > 0">
                <span class="meta-label">CFR References:</span>
                <span>{{ documentInfo.cfrReferences.join(', ') }}</span>
            </div>
    
            <!-- Docket IDs -->
            <div class="extended-meta-item" *ngIf="documentInfo.docketIds && documentInfo.docketIds.length > 0">
                <span class="meta-label">Docket IDs:</span>
                <span>{{ documentInfo.docketIds.join(', ') }}</span>
            </div>
    
            <!-- RINs -->
            <div class="extended-meta-item"
                *ngIf="documentInfo.regulationIdNumbers && documentInfo.regulationIdNumbers.length > 0">
                <span class="meta-label">Regulation ID Numbers:</span>
                <span>{{ documentInfo.regulationIdNumbers.join(', ') }}</span>
            </div>
    
            <!-- Comments Close Date -->
            <div class="extended-meta-item" *ngIf="documentInfo.commentsCloseOn">
                <span class="meta-label">Comments Close On:</span>
                <span>{{ documentInfo.commentsCloseOn }}</span>
            </div>
    
            <!-- Presidential Document Fields -->
            <div class="extended-meta-item" *ngIf="documentInfo.presidentialDocument">
                <span class="meta-label">Presidential Document:</span>
                <span>Yes</span>
            </div>
    
            <!-- Executive Order Number -->
            <div class="extended-meta-item" *ngIf="documentInfo.executiveOrder">
                <span class="meta-label">Executive Order:</span>
                <span>{{ documentInfo.executiveOrder }}</span>
            </div>
    
            <!-- Signing Date for Presidential Documents -->
            <div class="extended-meta-item" *ngIf="documentInfo.signingDate">
                <span class="meta-label">Signing Date:</span>
                <span>{{ documentInfo.signingDate }}</span>
            </div>
    
            <!-- Page Range if available -->
            <div class="extended-meta-item" *ngIf="documentInfo.startPage && documentInfo.endPage">
                <span class="meta-label">Pages:</span>
                <span>{{ documentInfo.startPage }}-{{ documentInfo.endPage }} ({{ documentInfo.endPage -
                    documentInfo.startPage + 1 }} pages)</span>
            </div>
        </div>
    </div>
    </div>
  
      <!-- Horizontal Divider -->
      <div class="section-divider"></div>
  
      <!-- Middle Section: Chat Messages -->
      <div class="chat-messages-section">
        <div class="chat-messages" #chatContainer>
          <ng-container *ngFor="let message of chatMessages">
            <app-chat-message
              [message]="message"
              [documentNumber]="documentInfo.documentNumber">
            </app-chat-message>
          </ng-container>
        </div>
      </div>
  
      <!-- Horizontal Divider -->
      <div class="section-divider"></div>
  
      <!-- Bottom Section: Split into Prompts and Input -->
      <div class="bottom-section">
        <!-- Left Side: Suggested Prompts -->
        <div class="suggested-prompts-area">
          <app-suggested-prompts
            [prompts]="suggestedPrompts"
            (promptSelected)="selectPrompt($event)">
          </app-suggested-prompts>
        </div>
        
        <!-- Vertical Divider -->
        <div class="vertical-divider"></div>
        
        <!-- Right Side: Chat Input -->
        <div class="chat-input-area">
          <div class="input-area">
            <mat-form-field appearance="outline" class="message-field">
              <textarea
                matInput
                #messageInput
                [formControl]="messageControl"
                [placeholder]="isInputDisabled ? 'Loading...' : 'Ask me about this document...'"
                [maxlength]="charLimit"
                rows="3" 
                (input)="autoResize(messageInput)"
                (keydown)="onKeydown($event)"
                [disabled]="isInputDisabled">
              </textarea>
              <mat-hint align="end">{{ getRemainingCharacters() }} characters remaining</mat-hint>
            </mat-form-field>
            
            <button 
              mat-fab 
              color="primary" 
              class="send-button" 
              [disabled]="messageControl.invalid || isInputDisabled"
              (click)="sendMessage()">
              <mat-icon>send</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>